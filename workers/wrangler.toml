name = "sunnycloud-api"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

[vars]
ENVIRONMENT = "production"
CORS_ORIGIN = "*"
# JWT_SECRET - 建议通过 wrangler secret put JWT_SECRET 设置安全密钥
# 以下域名变量需要配置为你自己的域名
# SITE_URL = "https://your-domain.com"
# API_URL = "https://api.your-domain.com"

# D1 Database binding
# 注意：database_id 需要替换为你自己创建的数据库 ID
[[d1_databases]]
binding = "DB"
database_name = "sunnycloud-db"
database_id = "你的数据库ID"  # 替换为你的 database_id

# R2 bucket binding
[[r2_buckets]]
binding = "BUCKET"
bucket_name = "sunnycloud-files"

# Wrangler 会自动编译 TypeScript

# Environment-specific configuration
[env.development]
vars = { ENVIRONMENT = "development", CORS_ORIGIN = "*" }
[[env.development.d1_databases]]
binding = "DB"
database_name = "sunnycloud-db"
database_id = "你的数据库ID"  # 替换为你的 database_id
[[env.development.r2_buckets]]
binding = "BUCKET"
bucket_name = "sunnycloud-files"

# 生产环境配置
# 部署前请配置你自己的域名
[env.production]
vars = { ENVIRONMENT = "production", CORS_ORIGIN = "*" }
# 如果有自定义域名，取消以下注释并配置
# routes = [
#   { pattern = "api.your-domain.com/*", zone_name = "your-domain.com" }
# ]
[[env.production.d1_databases]]
binding = "DB"
database_name = "sunnycloud-db"
database_id = "你的数据库ID"  # 替换为你的 database_id
[[env.production.r2_buckets]]
binding = "BUCKET"
bucket_name = "sunnycloud-files"

# 定时任务 - 每天凌晨0点清理过期文件
[triggers]
crons = ["0 0 * * *"]
